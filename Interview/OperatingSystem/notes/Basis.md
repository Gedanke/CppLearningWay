# 基础篇

基础篇主要是操作系统的一些基础知识

---

## 并发和并行

* 并行是指两个或者多个事件在同一时刻发生；而并发是指两个或多个事件在同一时间间隔发生
* 并行是在不同实体上的多个事件，并发是在同一实体上的多个事件

---

## 外中断和异常

外中断是指由 CPU 执行指令以外的事件引起，如 I/O 完成中断，表示设备输入/输出处理已经完成，处理器能够发送下一个输入/输出请求。此外还有时钟中断、控制台中断等

而异常时由 CPU 执行指令的内部事件引起，如非法操作码、地址越界、算术溢出等

---

## 进程和线程

进程：进程是系统进行资源分配和调度的一个独立单位，是系统中的并发执行的单位

线程：线程是进程的一个实体，也是 CPU 调度和分派的基本单位，它是比进程更小的能独立运行的基本单位，有时又被称为轻权进程或轻量级进程
* 线程启动速度快，轻量级
* 线程的系统开销小
* 线程使用有一定难度，需要处理数据一致性问题
* 同一线程共享的有堆、全局变量、静态变量、指针，引用、文件等，而独自占有栈

线程和进程的区别

* 调度：线程是调度的基本单位(PC，状态码，通用寄存器，线程栈及栈指针)；进程是拥有资源的基本单位(打开文件，堆，静态区，代码段等)
* 并发性：一个进程内多个线程可以并发(最好和 CPU 核数相等)；多个进程可以并发
* 拥有资源：线程不拥有系统资源，但一个进程的多个线程可以共享隶属进程的资源；进程是拥有资源的独立单位
* 系统开销：线程创建销毁只需要处理 PC 值，状态码，通用寄存器值，线程栈及栈指针即可；进程创建和销毁需要重新分配及销毁 `task_struct` 结构

一个进程可以创建多少线程？

* 如果是 32 位系统，用户态的虚拟空间只有 3G，如果创建线程时分配的栈空间是 10M，那么一个进程最多只能创建 300 个左右的线程
* 如果是 64 位系统，用户态的虚拟空间大到有 128T，理论上不会受虚拟内存大小的限制，而会受系统的参数或性能限制

过多的线程将会导致大量的时间浪费在线程切换上，给程序运行效率带来负面影响，无用线程要及时销毁

---

## 进程、线程和协程

|| 进程 | 线程 | 协程 |
|:----:|:----:|:----:|:----:|
| 定义 | 资源分配和拥有的基本单位 | 程序执行的基本单位 | 用户态的轻量级线程，线程内部调度的基本单位 |
| 切换情况 | 进程 CPU 环境(栈、寄存器、页表和文件句柄等)的保存以及新调度的进程 CPU 环境的设置 | 保存和设置程序计数器、少量寄存器和栈的内容 | 先将寄存器上下文和栈保存，等切换回来的时候再进行恢复 | 
| 切换者 | 操作系统 | 操作系统 | 用户 |
| 切换过程 | 用户态->内核态->用户态 | 用户态->内核态->用户态 | 用户态(没有陷入内核) |
| 调用栈 | 内核栈 |	内核栈 | 用户栈 |
| 拥有资源 | CPU 资源、内存资源、文件资源和句柄等 | 程序计数器、寄存器、栈和状态字 | 拥有自己的寄存器上下文和栈 |
| 并发性 | 不同进程之间切换实现并发，各自占有 CPU 实现并行 | 一个进程内部的多个线程并发执行 | 同一时间只能执行一个协程，而其他协程处于休眠状态，适合对任务进行分时处理 |
| 系统开销 | 切换虚拟地址空间，切换内核栈和硬件上下文，CPU 高速缓存失效、页表切换，开销很大	 | 切换时只需保存和设置少量寄存器内容，因此开销很小 | 直接操作栈则基本没有内核切换的开销，可以不加锁的访问全局变量，所以上下文的切换非常快 |
| 通信方面 | 进程间通信需要借助操作系统 | 线程间可以直接读写进程数据段(如全局变量)来进行通信 | 共享内存、消息队列 |

* 进程是资源调度的基本单位，运行一个可执行程序会创建一个或多个进程，进程就是运行起来的可执行程序
* 线程是程序执行的基本单位，是轻量级的进程。每个进程中都有唯一的主线程，且只能有一个，主线程和进程是相互依存的关系，主线程结束进程也会结束
* 协程是用户态的轻量级线程，线程内部调度的基本单位

---

## 逻辑地址与物理地址

编译时只需确定变量 `x` 存放的相对地址是 `0x0000000A`(也就是说相对于进程在内存中的起始地址而言的地址)。CPU 想要找到 `x` 在内存中的实际存放位置，只需要用进程的起始地址 `+0x0000000A` 即可，即偏移量。 相对地址又称逻辑地址，绝对地址又称物理地址

---

## 物理地址、逻辑地址、虚拟内存

* 物理地址：它是地址转换的最终地址，进程在运行时执行指令和访问数据最后都要通过物理地址从主存中存取，是内存单元真正的地址
* 逻辑地址：是指计算机用户看到的地址。例如：当创建一个长度为 10 的整型数组时，操作系统返回一个逻辑上的连续空间：指针指向数组第一个元素的内存地址。由于整型元素的大小为 4 个字节，故第二个元素的地址时起始地址加 4，以此类推。事实上，逻辑地址并不一定是元素存储的真实地址，即数组元素的物理地址(在内存中所处的位置)，并非是连续的，只是操作系统通过地址映射，将逻辑地址映射成连续的，这样更符合人们的直观思维
* 虚拟内存：是计算机系统内存管理的一种技术。它使得应用程序认为它拥有连续的可用的内存(一个连续完整的地址空间)，而实际上，它通常是被分隔成多个物理内存碎片，还有部分暂时存储在外部磁盘存储器上，在需要时进行数据交换

---

## 冯诺依曼结构

* 存储器：内存
* 控制器：主板上的南桥北桥
* 运算器：CPU
* 输入设备
* 输出设备


---
